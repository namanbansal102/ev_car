<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car IoT Monitoring Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'neon': '#39FF14', // Vibrant neon green
                        'neon-dark': '#32CD32', // Slightly darker neon
                        'neon-light': '#7FFF00', // Lighter neon
                        'background': '#050505', // Almost black
                        'card': '#0F0F0F', // Dark gray
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap');
        
        /* Hide scrollbars everywhere but keep scrolling functionality */
        ::-webkit-scrollbar {
            width: 0 !important;
            height: 0 !important;
            display: none !important;
        }
        
        * {
            scrollbar-width: none !important; /* Firefox */
            -ms-overflow-style: none !important; /* IE and Edge */
        }
        
        html, body {
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
            overflow-y: auto;
        }
        
        /* Ensure Leaflet containers don't show scrollbars */
        .leaflet-container::-webkit-scrollbar {
            width: 0 !important;
            height: 0 !important;
            display: none !important;
        }
        
        /* Hide scrollbars in the overflow container for the table */
        .overflow-x-auto::-webkit-scrollbar {
            display: none !important;
        }
        
        .overflow-x-auto {
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
        }
        
        body, html {
            margin: 0;
            padding: 0;
            background-color: #050505;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }
        
        .orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        
        /* Neon text effect */
        .neon-text {
            color: #fff;
            text-shadow: 
                0 0 2px #39FF14,
                0 0 5px #39FF14,
                0 0 7px #39FF14;
            transition: text-shadow 0.3s ease;
        }
        
        .neon-text-sm {
            color: #fff;
            text-shadow: 
                0 0 1px #39FF14,
                0 0 3px #39FF14;
        }
        
        /* Neon border effect */
        .neon-border {
            position: relative;
            border: 1px solid rgba(57, 255, 20, 0.3);
            box-shadow: 
                0 0 5px rgba(57, 255, 20, 0.5),
                0 0 10px rgba(57, 255, 20, 0.3),
                inset 0 0 5px rgba(57, 255, 20, 0.2);
            transition: all 0.3s ease;
        }
        
        .neon-border:hover {
            box-shadow: 
                0 0 5px rgba(57, 255, 20, 0.7),
                0 0 15px rgba(57, 255, 20, 0.5),
                0 0 30px rgba(57, 255, 20, 0.3),
                inset 0 0 10px rgba(57, 255, 20, 0.3);
        }
        
        /* Animated background */
        .cyber-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                linear-gradient(to bottom, #050505 0%, #0a0a0a 100%);
            overflow: hidden;
        }
        
        .cyber-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: 50px 50px;
            background-image: 
                linear-gradient(rgba(57, 255, 20, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(57, 255, 20, 0.03) 1px, transparent 1px);
            perspective: 500px;
            transform-style: preserve-3d;
            animation: grid-animation 20s linear infinite;
        }
        
        @keyframes grid-animation {
            0% {
                transform: rotateX(75deg) translateY(0);
            }
            100% {
                transform: rotateX(75deg) translateY(50px);
            }
        }
        
        .cyber-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: rgba(57, 255, 20, 0.7);
            border-radius: 50%;
            box-shadow: 0 0 10px 2px rgba(57, 255, 20, 0.5);
            animation: particle-animation linear infinite;
        }
        
        @keyframes particle-animation {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(20px);
                opacity: 0;
            }
        }
        
        /* Scan line effect */
        .scan-lines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                rgba(57, 255, 20, 0.03) 50%,
                rgba(0, 0, 0, 0.02) 50%
            );
            background-size: 100% 4px;
            z-index: 2;
            pointer-events: none;
            opacity: 0.2;
        }
        
        .scan-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 0%,
                rgba(57, 255, 20, 0.1) 50%,
                transparent 100%
            );
            background-size: 100% 100vh;
            animation: scan 8s linear infinite;
            z-index: 1;
            pointer-events: none;
        }
        
        @keyframes scan {
            0% {
                transform: translateY(-100vh);
            }
            100% {
                transform: translateY(100vh);
            }
        }
        
        /* Map styling */
        #map { 
            height: 300px; 
            width: 100%;
            border-radius: 0.5rem;
            box-shadow: 
                0 0 10px rgba(57, 255, 20, 0.5),
                0 0 20px rgba(57, 255, 20, 0.3);
            transition: all 0.5s ease;
            position: relative;
            z-index: 1;
        }
        
        #map::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0.5rem;
            box-shadow: inset 0 0 20px rgba(57, 255, 20, 0.3);
            pointer-events: none;
            z-index: 2;
        }
        
        /* Alert animations */
        .alert-pulse {
            animation: alert-pulse 1.5s infinite;
        }
        
        @keyframes alert-pulse {
            0% {
                box-shadow: 
                    0 0 0 0 rgba(239, 68, 68, 0.7),
                    inset 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 
                    0 0 0 15px rgba(239, 68, 68, 0),
                    inset 0 0 0 5px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 
                    0 0 0 0 rgba(239, 68, 68, 0),
                    inset 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        
        .neon-pulse {
            animation: neon-pulse 3s infinite;
        }
        
        @keyframes neon-pulse {
            0% {
                box-shadow: 
                    0 0 0 0 rgba(57, 255, 20, 0.7),
                    inset 0 0 0 0 rgba(57, 255, 20, 0.7);
            }
            70% {
                box-shadow: 
                    0 0 0 10px rgba(57, 255, 20, 0),
                    inset 0 0 0 3px rgba(57, 255, 20, 0);
            }
            100% {
                box-shadow: 
                    0 0 0 0 rgba(57, 255, 20, 0),
                    inset 0 0 0 0 rgba(57, 255, 20, 0);
            }
        }
        
        /* Car visualization */
        .car-silhouette {
            position: relative;
            width: 100%;
            height: 120px;
            margin: 20px 0;
            perspective: 800px;
        }
        
        .car-container {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            animation: car-float 4s ease-in-out infinite;
        }
        
        @keyframes car-float {
            0%, 100% { transform: translateY(0px) rotateX(0deg); }
            50% { transform: translateY(-5px) rotateX(2deg); }
        }
        
        .car-silhouette svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 10px rgba(57, 255, 20, 0.8));
        }
        
        .car-silhouette path, .car-silhouette circle {
            stroke: #39FF14;
            stroke-width: 2;
            fill: rgba(57, 255, 20, 0.05);
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 3s linear forwards;
        }
        
        @keyframes dash {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        .sensor-dot {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #39FF14;
            border-radius: 50%;
            box-shadow: 0 0 15px 5px rgba(57, 255, 20, 0.7);
            z-index: 2;
            transition: all 0.5s ease;
        }
        
        .sensor-dot.battery {
            top: 40%;
            left: 25%;
        }
        
        .sensor-dot.temp {
            top: 30%;
            left: 50%;
        }
        
        .sensor-dot.gas {
            top: 60%;
            left: 70%;
        }
        
        .sensor-dot.fire {
            top: 50%;
            left: 40%;
        }
        
        .sensor-dot.active {
            animation: sensor-pulse 1.5s infinite;
            background-color: #ff3a3a;
            box-shadow: 0 0 15px 5px rgba(255, 58, 58, 0.7);
        }
        
        @keyframes sensor-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 58, 58, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(255, 58, 58, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 58, 58, 0);
            }
        }
        
        .sensor-line {
            position: absolute;
            background-color: rgba(57, 255, 20, 0.3);
            z-index: 1;
            transform-origin: left center;
        }
        
        /* Digital gauges */
        .digital-gauge {
            font-family: 'Orbitron', monospace;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(57, 255, 20, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.8), 
                0 0 10px rgba(57, 255, 20, 0.5);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .digital-gauge:hover {
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.8), 
                0 0 15px rgba(57, 255, 20, 0.7);
        }
        
        .digital-gauge::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(57, 255, 20, 0.2), transparent);
            animation: digital-scan 3s linear infinite;
        }
        
        @keyframes digital-scan {
            0% { left: -100%; }
            100% { left: 200%; }
        }
        
        /* Speedometer */
        .speedometer {
            position: relative;
            width: 100%;
            height: 120px;
            overflow: hidden;
        }
        
        .speedometer-arc {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 100px;
            border-top-left-radius: 100px;
            border-top-right-radius: 100px;
            background: linear-gradient(to right, rgba(57, 255, 20, 0.1), rgba(57, 255, 20, 0.3), rgba(57, 255, 20, 0.1));
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.3);
        }
        
        .speedometer-ticks {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 100px;
            border-top-left-radius: 100px;
            border-top-right-radius: 100px;
        }
        
        .speedometer-tick {
            position: absolute;
            bottom: 0;
            left: 50%;
            height: 10px;
            width: 2px;
            background-color: rgba(57, 255, 20, 0.7);
            transform-origin: bottom center;
        }
        
        .speedometer-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            height: 90px;
            width: 3px;
            background-color: #39FF14;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            transition: transform 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1;
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.7);
        }
        
        .speedometer-needle::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: -5px;
            width: 12px;
            height: 12px;
            background-color: #39FF14;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.9);
        }
        
        /* Status indicators */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
            transition: all 0.3s ease;
        }
        
        .status-indicator.active {
            background-color: #39FF14;
            box-shadow: 0 0 10px #39FF14;
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Progress bars */
        .progress-bar {
            overflow: hidden;
            height: 8px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .progress-bar-fill {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, rgba(57, 255, 20, 0.7), #39FF14);
            position: relative;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.7);
        }
        
        .progress-bar-fill::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            animation: progress-glow 1s infinite;
        }
        
        @keyframes progress-glow {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.3; }
        }
        
        /* Table styling */
        .cyber-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .cyber-table th {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(57, 255, 20, 0.2);
            transition: all 0.3s ease;
        }
        
        .cyber-table td {
            padding: 12px;
            border-top: 1px solid rgba(57, 255, 20, 0.1);
            transition: all 0.3s ease;
        }
        
        .cyber-table tr:hover td {
            background-color: rgba(57, 255, 20, 0.05);
            box-shadow: 0 0 10px rgba(57, 255, 20, 0.1);
        }
        
        /* Connection status */
        .connection-status {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.5s ease;
        }
        
        .connection-dot {
            height: 8px;
            width: 8px;
            margin-right: 8px;
            border-radius: 50%;
            transition: all 0.5s ease;
        }
        
        /* Animations for page load */
        .fade-in {
            opacity: 0;
            animation: fadeIn 0.8s forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Staggered animations */
        .stagger-1 { animation-delay: 0.1s; }
        .stagger-2 { animation-delay: 0.2s; }
        .stagger-3 { animation-delay: 0.3s; }
        .stagger-4 { animation-delay: 0.4s; }
        .stagger-5 { animation-delay: 0.5s; }
        
        /* Hover effects */
        .hover-scale {
            transition: transform 0.3s ease;
        }
        
        .hover-scale:hover {
            transform: scale(1.02);
        }
        
        /* Glitch effect for alerts */
        .glitch {
            position: relative;
            animation: glitch-skew 1s infinite linear alternate-reverse;
        }
        
        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch::before {
            left: 2px;
            text-shadow: -2px 0 #ff00c1;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        
        .glitch::after {
            left: -2px;
            text-shadow: -2px 0 #00fff9, 2px 2px #ff00c1;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% { clip: rect(31px, 9999px, 94px, 0); transform: skew(0.65deg); }
            5% { clip: rect(70px, 9999px, 71px, 0); transform: skew(0.23deg); }
            10% { clip: rect(55px, 9999px, 29px, 0); transform: skew(0.05deg); }
            15% { clip: rect(90px, 9999px, 73px, 0); transform: skew(0.76deg); }
            20% { clip: rect(26px, 9999px, 67px, 0); transform: skew(0.98deg); }
            25% { clip: rect(7px, 9999px, 336px, 0); transform: skew(0.2deg); }
            30% { clip: rect(68px, 9999px, 33px, 0); transform: skew(0.99deg); }
            35% { clip: rect(71px, 9999px, 19px, 0); transform: skew(0.2deg); }
            40% { clip: rect(2px, 9999px, 23px, 0); transform: skew(0.25deg); }
            45% { clip: rect(13px, 9999px, 76px, 0); transform: skew(0.67deg); }
            50% { clip: rect(46px, 9999px, 98px, 0); transform: skew(0.05deg); }
            55% { clip: rect(22px, 9999px, 46px, 0); transform: skew(0.65deg); }
            60% { clip: rect(60px, 9999px, 64px, 0); transform: skew(0.92deg); }
            65% { clip: rect(98px, 9999px, 68px, 0); transform: skew(0.43deg); }
            70% { clip: rect(67px, 9999px, 26px, 0); transform: skew(0.38deg); }
            75% { clip: rect(67px, 9999px, 94px, 0); transform: skew(0.71deg); }
            80% { clip: rect(40px, 9999px, 88px, 0); transform: skew(0.85deg); }
            85% { clip: rect(67px, 9999px, 99px, 0); transform: skew(0.26deg); }
            90% { clip: rect(99px, 9999px, 59px, 0); transform: skew(0.56deg); }
            95% { clip: rect(3px, 9999px, 11px, 0); transform: skew(0.31deg); }
            100% { clip: rect(47px, 9999px, 18px, 0); transform: skew(0.98deg); }
        }
        
        @keyframes glitch-anim2 {
            0% { clip: rect(63px, 9999px, 63px, 0); transform: skew(0.74deg); }
            5% { clip: rect(47px, 9999px, 31px, 0); transform: skew(0.05deg); }
            10% { clip: rect(28px, 9999px, 26px, 0); transform: skew(0.85deg); }
            15% { clip: rect(54px, 9999px, 30px, 0); transform: skew(0.46deg); }
            20% { clip: rect(20px, 9999px, 59px, 0); transform: skew(0.05deg); }
            25% { clip: rect(18px, 9999px, 92px, 0); transform: skew(0.49deg); }
            30% { clip: rect(71px, 9999px, 21px, 0); transform: skew(0.8deg); }
            35% { clip: rect(86px, 9999px, 99px, 0); transform: skew(0.28deg); }
            40% { clip: rect(52px, 9999px, 32px, 0); transform: skew(0.65deg); }
            45% { clip: rect(62px, 9999px, 94px, 0); transform: skew(0.72deg); }
            50% { clip: rect(11px, 9999px, 11px, 0); transform: skew(0.58deg); }
            55% { clip: rect(25px, 9999px, 71px, 0); transform: skew(0.23deg); }
            60% { clip: rect(46px, 9999px, 81px, 0); transform: skew(0.95deg); }
            65% { clip: rect(73px, 9999px, 5px, 0); transform: skew(0.34deg); }
            70% { clip: rect(71px, 9999px, 40px, 0); transform: skew(0.51deg); }
            75% { clip: rect(34px, 9999px, 30px, 0); transform: skew(0.97deg); }
            80% { clip: rect(97px, 9999px, 62px, 0); transform: skew(0.28deg); }
            85% { clip: rect(39px, 9999px, 29px, 0); transform: skew(0.36deg); }
            90% { clip: rect(61px, 9999px, 50px, 0); transform: skew(0.7deg); }
            95% { clip: rect(83px, 9999px, 98px, 0); transform: skew(0.76deg); }
            100% { clip: rect(66px, 9999px, 98px, 0); transform: skew(0.33deg); }
        }
    </style>
</head>
<body>
    <!-- Background effects -->
    <div class="cyber-bg">
        <div class="cyber-grid"></div>
        <div class="cyber-particles" id="particles"></div>
    </div>
    <div class="scan-lines"></div>
    <div class="scan-effect"></div>
    
    <div class="container mx-auto px-4 py-8 relative z-10">
        <header class="mb-8 relative fade-in">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-70"></div>
            <h1 class="text-4xl font-bold text-neon flex items-center neon-text orbitron">
                <i class="fas fa-car mr-3"></i>
                CAR IoT DASHBOARD
            </h1>
            <p class="text-gray-400 mt-2">REAL-TIME VEHICLE MONITORING SYSTEM v1.0</p>
            <div class="absolute bottom-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-neon to-transparent opacity-30"></div>
        </header>

        <!-- Car Visualization -->
        <div class="bg-card rounded-lg p-6 shadow-lg neon-border mb-8 fade-in stagger-1 hover-scale">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-neon neon-text-sm">Vehicle Status</h2>
                <div>
                    <span id="connection-status" class="connection-status bg-yellow-900 text-yellow-300">
                        <span class="connection-dot bg-yellow-300 animate-pulse"></span>
                        Connecting...
                    </span>
                </div>
            </div>
            
            <div class="car-silhouette">
                <div class="car-container">
                    <svg viewBox="0 0 1000 300" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M220,250 L250,180 L380,150 L620,150 L750,180 L780,250 Z" fill="rgba(57, 255, 20, 0.05)" stroke="#39FF14" stroke-width="2"/>
                        <path d="M300,180 L350,120 L650,120 L700,180" fill="none" stroke="#39FF14" stroke-width="2"/>
                        <circle cx="300" cy="250" r="40" fill="rgba(57, 255, 20, 0.05)" stroke="#39FF14" stroke-width="2"/>
                        <circle cx="700" cy="250" r="40" fill="rgba(57, 255, 20, 0.05)" stroke="#39FF14" stroke-width="2"/>
                    </svg>
                    
                    <div id="battery-dot" class="sensor-dot battery active"></div>
                    <div id="temp-dot" class="sensor-dot temp active"></div>
                    <div id="gas-dot" class="sensor-dot gas"></div>
                    <div id="fire-dot" class="sensor-dot fire"></div>
                </div>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                <div class="text-center">
                    <div class="text-xs text-gray-400 mb-1 orbitron">BATTERY</div>
                    <div id="battery-indicator" class="digital-gauge">
                        <span id="battery-percentage-small" class="text-xl font-bold text-neon neon-text-sm">--</span>
                        <span class="text-neon">%</span>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-gray-400 mb-1 orbitron">TEMPERATURE</div>
                    <div id="temp-indicator" class="digital-gauge">
                        <span id="temperature-small" class="text-xl font-bold text-neon neon-text-sm">--</span>
                        <span class="text-neon">°C</span>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-gray-400 mb-1 orbitron">GAS SENSOR</div>
                    <div id="gas-indicator" class="digital-gauge">
                        <span id="gas-status-small" class="text-xl font-bold text-green-500">OK</span>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-gray-400 mb-1 orbitron">FIRE SENSOR</div>
                    <div id="fire-indicator" class="digital-gauge">
                        <span id="fire-status-small" class="text-xl font-bold text-green-500">OK</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Battery Card -->
            <div class="bg-card rounded-lg p-6 shadow-lg neon-border neon-pulse fade-in stagger-2 hover-scale">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-300 orbitron">Battery Status</h2>
                    <i class="fas fa-battery-half text-neon text-xl"></i>
                </div>
                <div class="relative pt-1">
                    <div class="flex mb-2 items-center justify-between">
                        <div>
                            <span id="battery-percentage" class="text-3xl font-bold text-neon neon-text orbitron">--</span>
                            <span class="text-neon text-lg">%</span>
                        </div>
                    </div>
                    <div class="progress-bar mb-4">
                        <div id="battery-bar" class="progress-bar-fill" style="width: 0%"></div>
                    </div>
                    <div class="speedometer">
                        <div class="speedometer-arc"></div>
                        <div class="speedometer-ticks" id="speedometer-ticks"></div>
                        <div id="battery-needle" class="speedometer-needle" style="transform: translateX(-50%) rotate(-90deg)"></div>
                    </div>
                </div>
            </div>

            <!-- Temperature Card -->
            <div class="bg-card rounded-lg p-6 shadow-lg neon-border fade-in stagger-3 hover-scale">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-300 orbitron">Battery Temperature</h2>
                    <i class="fas fa-temperature-high text-neon text-xl"></i>
                </div>
                <div class="text-center">
                    <span id="temperature" class="text-3xl font-bold text-neon neon-text orbitron">--</span>
                    <span class="text-neon text-lg">°C</span>
                    <div class="mt-4">
                        <canvas id="tempChart" width="100%" height="80"></canvas>
                    </div>
                </div>
            </div>

            <!-- Gas Detection Card -->
            <div id="gas-card" class="bg-card rounded-lg p-6 shadow-lg neon-border fade-in stagger-4 hover-scale">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-300 orbitron">Gas Detection</h2>
                    <i class="fas fa-wind text-neon text-xl"></i>
                </div>
                <div class="text-center">
                    <div id="gas-status" class="text-2xl font-bold text-green-500 mt-2 neon-text-sm orbitron">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span>No Gas Detected</span>
                    </div>
                    <div class="mt-4 p-3 bg-opacity-20 bg-green-900 rounded-lg neon-border">
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-400">Sensor Status:</span>
                            <span class="text-xs text-green-400 flex items-center">
                                <span class="status-indicator active"></span>
                                Active
                            </span>
                        </div>
                        <div class="flex items-center justify-between mt-2">
                            <span class="text-xs text-gray-400">Last Check:</span>
                            <span id="gas-last-check" class="text-xs text-green-400">Just now</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fire Detection Card -->
            <div id="fire-card" class="bg-card rounded-lg p-6 shadow-lg neon-border fade-in stagger-5 hover-scale">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-300 orbitron">Fire Detection</h2>
                    <i class="fas fa-fire text-neon text-xl"></i>
                </div>
                <div class="text-center">
                    <div id="fire-status" class="text-2xl font-bold text-green-500 mt-2 neon-text-sm orbitron">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span>No Fire Detected</span>
                    </div>
                    <div class="mt-4 p-3 bg-opacity-20 bg-green-900 rounded-lg neon-border">
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-400">Sensor Status:</span>
                            <span class="text-xs text-green-400 flex items-center">
                                <span class="status-indicator active"></span>
                                Active
                            </span>
                        </div>
                        <div class="flex items-center justify-between mt-2">
                            <span class="text-xs text-gray-400">Last Check:</span>
                            <span id="fire-last-check" class="text-xs text-green-400">Just now</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location Section -->
        <div class="bg-card rounded-lg p-6 shadow-lg neon-border mb-8 fade-in stagger-2 hover-scale">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-neon neon-text-sm orbitron">Vehicle Location</h2>
                <i class="fas fa-map-marker-alt text-neon text-xl"></i>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-1">
                    <div class="mb-4">
                        <h3 class="text-gray-300 mb-2 orbitron">GPS Coordinates</h3>
                        <div class="bg-background p-4 rounded-lg neon-border">
                            <div class="mb-2">
                                <span class="text-gray-400">Latitude:</span>
                                <span id="latitude" class="text-neon font-mono">--</span>
                            </div>
                            <div>
                                <span class="text-gray-400">Longitude:</span>
                                <span id="longitude" class="text-neon font-mono">--</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-gray-300 mb-2 orbitron">Last Updated</h3>
                        <div class="bg-background p-4 rounded-lg neon-border">
                            <span id="last-updated" class="text-neon">--</span>
                        </div>
                    </div>
                </div>
                <div class="md:col-span-2">
                    <div id="map"></div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="bg-card rounded-lg p-6 shadow-lg neon-border fade-in stagger-3 hover-scale">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-neon neon-text-sm orbitron">System Diagnostics</h2>
                <div class="text-xs text-gray-400">
                    <span class="mr-2">System ID:</span>
                    <span class="text-neon font-mono">CAR-IOT-001</span>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="cyber-table min-w-full">
                    <thead>
                        <tr>
                            <th class="text-gray-400 orbitron">Sensor</th>
                            <th class="text-gray-400 orbitron">Status</th>
                            <th class="text-gray-400 orbitron">Last Reading</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Battery Sensor</td>
                            <td><span id="battery-sensor-status" class="text-yellow-300">Waiting...</span></td>
                            <td><span id="battery-last-reading">--</span></td>
                        </tr>
                        <tr>
                            <td>Temperature Sensor</td>
                            <td><span id="temp-sensor-status" class="text-yellow-300">Waiting...</span></td>
                            <td><span id="temp-last-reading">--</span></td>
                        </tr>
                        <tr>
                            <td>Gas Detector</td>
                            <td><span id="gas-sensor-status" class="text-yellow-300">Waiting...</span></td>
                            <td><span id="gas-last-reading">--</span></td>
                        </tr>
                        <tr>
                            <td>Fire Detector</td>
                            <td><span id="fire-sensor-status" class="text-yellow-300">Waiting...</span></td>
                            <td><span id="fire-last-reading">--</span></td>
                        </tr>
                        <tr>
                            <td>GPS</td>
                            <td><span id="gps-sensor-status" class="text-yellow-300">Waiting...</span></td>
                            <td><span id="gps-last-reading">--</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Create particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random position
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                particle.style.left = `${posX}%`;
                particle.style.top = `${posY}%`;
                
                // Random size
                const size = Math.random() * 3 + 1;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random animation duration
                const duration = Math.random() * 20 + 10;
                particle.style.animationDuration = `${duration}s`;
                
                // Random delay
                const delay = Math.random() * 10;
                particle.style.animationDelay = `${delay}s`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Create speedometer ticks
        function createSpeedometerTicks() {
            const ticksContainer = document.getElementById('speedometer-ticks');
            const tickCount = 11; // 0% to 100% in 10% increments
            
            for (let i = 0; i < tickCount; i++) {
                const tick = document.createElement('div');
                tick.className = 'speedometer-tick';
                
                // Position tick
                const angle = -90 + (i * 180 / (tickCount - 1));
                tick.style.transform = `translateX(-50%) rotate(${angle}deg)`;
                
                // Make major ticks longer
                if (i % 2 === 0) {
                    tick.style.height = '15px';
                    tick.style.width = '2px';
                    tick.style.boxShadow = '0 0 5px rgba(57, 255, 20, 0.7)';
                }
                
                ticksContainer.appendChild(tick);
            }
        }

        // Initialize temperature chart with glowing effect
        const ctx = document.getElementById('tempChart').getContext('2d');
        const tempChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(10).fill(''),
                datasets: [{
                    label: 'Temperature',
                    data: Array(10).fill(null),
                    borderColor: '#39FF14',
                    backgroundColor: 'rgba(57, 255, 20, 0.2)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        display: false
                    },
                    x: {
                        display: false
                    }
                },
                elements: {
                    point: {
                        radius: 0
                    },
                    line: {
                        borderWidth: 2
                    }
                }
            }
        });

        // Initialize map with custom style
        let map = L.map('map').setView([0, 0], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors',
            className: 'map-tiles'
        }).addTo(map);
        
        // Custom map style with neon green theme
        document.querySelector('.leaflet-container').style.filter = 'hue-rotate(85deg) saturate(1.2) brightness(0.9) contrast(1.1)';
        
        let marker = L.marker([0, 0]).addTo(map);

        // Sample data for demonstration
        const tempHistory = Array(10).fill(25);
        let lastData = null;

        // Function to update the UI with new data
        function updateUI(data) {
            lastData = data;
            
            // Check for alert conditions and maintain alert state
            checkAndUpdateAlertState(data);
            
            // Update battery
            const batteryPercentage = document.getElementById('battery-percentage');
            const batteryPercentageSmall = document.getElementById('battery-percentage-small');
            const batteryBar = document.getElementById('battery-bar');
            
            if (batteryPercentage) batteryPercentage.textContent = data.battery;
            if (batteryPercentageSmall) batteryPercentageSmall.textContent = data.battery;
            if (batteryBar) batteryBar.style.width = `${data.battery}%`;
            
            // Update battery needle with smooth animation
            const batteryNeedle = document.getElementById('battery-needle');
            if (batteryNeedle) {
                const batteryDegree = (data.battery / 100) * 180 - 90;
                batteryNeedle.style.transform = `translateX(-50%) rotate(${batteryDegree}deg)`;
            }
            
            // Update battery icon based on percentage
            const batteryIcon = document.querySelector('.fa-battery-half');
            if (batteryIcon) {
                if (data.battery > 80) {
                    batteryIcon.className = 'fas fa-battery-full text-neon text-xl';
                } else if (data.battery > 60) {
                    batteryIcon.className = 'fas fa-battery-three-quarters text-neon text-xl';
                } else if (data.battery > 40) {
                    batteryIcon.className = 'fas fa-battery-half text-neon text-xl';
                } else if (data.battery > 20) {
                    batteryIcon.className = 'fas fa-battery-quarter text-neon text-xl text-yellow-500';
                } else {
                    batteryIcon.className = 'fas fa-battery-empty text-neon text-xl text-red-500';
                }
            }
            
            // Update temperature
            const temperatureElement = document.getElementById('temperature');
            const temperatureSmall = document.getElementById('temperature-small');
            if (temperatureElement) temperatureElement.textContent = data.temperature;
            if (temperatureSmall) temperatureSmall.textContent = data.temperature;
            
            // Update temperature chart
            tempHistory.push(data.temperature);
            tempHistory.shift();
            if (tempChart && tempChart.data) {
                tempChart.data.datasets[0].data = tempHistory;
                tempChart.update();
            }
            
            // Update location
            const latitudeElement = document.getElementById('latitude');
            const longitudeElement = document.getElementById('longitude');
            if (latitudeElement) latitudeElement.textContent = data.latitude.toFixed(6);
            if (longitudeElement) longitudeElement.textContent = data.longitude.toFixed(6);
            
            // Update map
            if (map && marker) {
                map.setView([data.latitude, data.longitude], 13);
                marker.setLatLng([data.latitude, data.longitude]);
            }
            
            // Update last updated time
            const now = new Date();
            const lastUpdatedElement = document.getElementById('last-updated');
            const gasLastCheck = document.getElementById('gas-last-check');
            const fireLastCheck = document.getElementById('fire-last-check');
            
            if (lastUpdatedElement) lastUpdatedElement.textContent = now.toLocaleString();
            if (gasLastCheck) gasLastCheck.textContent = 'Just now';
            if (fireLastCheck) fireLastCheck.textContent = 'Just now';
            
            // Update sensor statuses
            updateSensorStatus('battery-sensor-status', 'Online', 'text-green-500');
            updateSensorValue('battery-last-reading', `${data.battery}%`);
            
            updateSensorStatus('temp-sensor-status', 'Online', 'text-green-500');
            updateSensorValue('temp-last-reading', `${data.temperature}°C`);
            
            updateSensorStatus('gas-sensor-status', 'Online', 'text-green-500');
            updateSensorValue('gas-last-reading', data.gasDetected ? 'Detected' : 'Not Detected');
            
            updateSensorStatus('fire-sensor-status', 'Online', 'text-green-500');
            updateSensorValue('fire-last-reading', data.fireDetected ? 'Detected' : 'Not Detected');
            
            updateSensorStatus('gps-sensor-status', 'Online', 'text-green-500');
            updateSensorValue('gps-last-reading', `${data.latitude.toFixed(6)}, ${data.longitude.toFixed(6)}`);
            
            // Update connection status
            const connectionStatus = document.getElementById('connection-status');
            if (connectionStatus) {
                connectionStatus.className = 'connection-status bg-green-900 text-green-300';
                connectionStatus.innerHTML = '<span class="connection-dot bg-green-300 animate-pulse"></span>Connected';
            }
        }
        
        // Alert state tracking variables
        let alertStates = {
            temperature: { active: false, until: 0 },
            gas: { active: false, until: 0 },
            fire: { active: false, until: 0 }
        };
        
        // Function to check alert conditions and update alert state
        function checkAndUpdateAlertState(data) {
            const now = Date.now();
            const ALERT_DURATION = 5 * 60 * 1000; // 5 minutes in milliseconds
            
            // Check high temperature
            if (data.temperature > 50) {
                alertStates.temperature.active = true;
                alertStates.temperature.until = now + ALERT_DURATION;
            } else if (alertStates.temperature.active && now > alertStates.temperature.until) {
                alertStates.temperature.active = false;
            }
            
            // Check gas detection
            if (data.gasDetected) {
                alertStates.gas.active = true;
                alertStates.gas.until = now + ALERT_DURATION;
            } else if (alertStates.gas.active && now > alertStates.gas.until) {
                alertStates.gas.active = false;
            }
            
            // Check fire detection
            if (data.fireDetected) {
                alertStates.fire.active = true;
                alertStates.fire.until = now + ALERT_DURATION;
            } else if (alertStates.fire.active && now > alertStates.fire.until) {
                alertStates.fire.active = false;
            }
            
            // Apply alert states to UI components
            applyAlertStates(data);
        }
        
        // Function to apply alert states to UI
        function applyAlertStates(data) {
            // Override the actual data with the persisted alert states
            const effectiveData = {
                ...data,
                temperature: data.temperature,
                gasDetected: data.gasDetected || alertStates.gas.active,
                fireDetected: data.fireDetected || alertStates.fire.active
            };
            
            // Display high temperature warning if in alert state
            if (alertStates.temperature.active && data.temperature <= 50) {
                const tempElement = document.getElementById('temperature');
                const tempSmall = document.getElementById('temperature-small');
                const tempDot = document.getElementById('temp-dot');
                
                if (tempElement) {
                    tempElement.innerHTML = `<span class="text-red-500">${data.temperature}</span>`;
                    tempElement.setAttribute('title', 'High temperature detected recently');
                }
                
                if (tempSmall) {
                    tempSmall.innerHTML = `<span class="text-red-500">${data.temperature}</span>`;
                }
                
                if (tempDot) {
                    tempDot.classList.add('active');
                }
                
                // Add a warning badge
                addOrUpdateAlertBadge('temperature', 'High temperature detected recently');
            } else if (!alertStates.temperature.active) {
                removeAlertBadge('temperature');
            }
            
            // Update gas indicators based on effective data
            updateGasIndicators(effectiveData.gasDetected);
            
            // Update fire indicators based on effective data
            updateFireIndicators(effectiveData.fireDetected);
            
            // Update header with alert status
            updateHeaderAlertStatus();
        }
        
        // Function to update gas indicators
        function updateGasIndicators(gasDetected) {
            const gasCard = document.getElementById('gas-card');
            const gasStatus = document.getElementById('gas-status');
            const gasStatusSmall = document.getElementById('gas-status-small');
            const gasDot = document.getElementById('gas-dot');
            const gasIndicator = document.getElementById('gas-indicator');
            
            if (gasCard && gasStatus && gasStatusSmall && gasDot) {
                if (gasDetected) {
                    gasCard.classList.add('alert-pulse');
                    gasCard.classList.remove('neon-pulse');
                    gasStatus.className = 'text-2xl font-bold text-red-500 mt-2 orbitron glitch';
                    gasStatus.setAttribute('data-text', 'Gas Detected!');
                    gasStatus.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i><span>Gas Detected!</span>';
                    gasStatusSmall.className = 'text-xl font-bold text-red-500';
                    gasStatusSmall.textContent = 'ALERT';
                    gasDot.classList.add('active');
                    if (gasIndicator) gasIndicator.style.boxShadow = '0 0 15px rgba(239, 68, 68, 0.7)';
                    
                    // Add alert badge
                    addOrUpdateAlertBadge('gas', 'Gas leak detected recently');
                } else {
                    gasCard.classList.remove('alert-pulse');
                    gasCard.classList.add('neon-pulse');
                    gasStatus.className = 'text-2xl font-bold text-green-500 mt-2 neon-text-sm orbitron';
                    gasStatus.removeAttribute('data-text');
                    gasStatus.innerHTML = '<i class="fas fa-check-circle mr-2"></i><span>No Gas Detected</span>';
                    gasStatusSmall.className = 'text-xl font-bold text-green-500';
                    gasStatusSmall.textContent = 'OK';
                    gasDot.classList.remove('active');
                    if (gasIndicator) gasIndicator.style.boxShadow = '0 0 5px rgba(57, 255, 20, 0.5)';
                    
                    // Remove alert badge
                    removeAlertBadge('gas');
                }
            }
        }
        
        // Function to update fire indicators
        function updateFireIndicators(fireDetected) {
            const fireCard = document.getElementById('fire-card');
            const fireStatus = document.getElementById('fire-status');
            const fireStatusSmall = document.getElementById('fire-status-small');
            const fireDot = document.getElementById('fire-dot');
            const fireIndicator = document.getElementById('fire-indicator');
            
            if (fireCard && fireStatus && fireStatusSmall && fireDot) {
                if (fireDetected) {
                    fireCard.classList.add('alert-pulse');
                    fireCard.classList.remove('neon-pulse');
                    fireStatus.className = 'text-2xl font-bold text-red-500 mt-2 orbitron glitch';
                    fireStatus.setAttribute('data-text', 'Fire Detected!');
                    fireStatus.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i><span>Fire Detected!</span>';
                    fireStatusSmall.className = 'text-xl font-bold text-red-500';
                    fireStatusSmall.textContent = 'ALERT';
                    fireDot.classList.add('active');
                    if (fireIndicator) fireIndicator.style.boxShadow = '0 0 15px rgba(239, 68, 68, 0.7)';
                    
                    // Add alert badge
                    addOrUpdateAlertBadge('fire', 'Fire detected recently');
                } else {
                    fireCard.classList.remove('alert-pulse');
                    fireCard.classList.add('neon-pulse');
                    fireStatus.className = 'text-2xl font-bold text-green-500 mt-2 neon-text-sm orbitron';
                    fireStatus.removeAttribute('data-text');
                    fireStatus.innerHTML = '<i class="fas fa-check-circle mr-2"></i><span>No Fire Detected</span>';
                    fireStatusSmall.className = 'text-xl font-bold text-green-500';
                    fireStatusSmall.textContent = 'OK';
                    fireDot.classList.remove('active');
                    if (fireIndicator) fireIndicator.style.boxShadow = '0 0 5px rgba(57, 255, 20, 0.5)';
                    
                    // Remove alert badge
                    removeAlertBadge('fire');
                }
            }
        }
        
        // Function to add or update alert badge
        function addOrUpdateAlertBadge(type, message) {
            const id = `alert-badge-${type}`;
            let badge = document.getElementById(id);
            
            if (!badge) {
                badge = document.createElement('div');
                badge.id = id;
                badge.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-900 text-white py-2 px-4 rounded-lg shadow-lg z-50 flex items-center';
                badge.style.opacity = '0';
                badge.style.transition = 'opacity 0.5s ease';
                
                const icon = document.createElement('i');
                icon.className = 'fas fa-exclamation-triangle mr-2';
                badge.appendChild(icon);
                
                const text = document.createElement('span');
                text.className = 'message';
                text.textContent = message;
                badge.appendChild(text);
                
                const countdown = document.createElement('span');
                countdown.className = 'ml-2 countdown text-xs bg-red-700 px-2 py-1 rounded';
                badge.appendChild(countdown);
                
                document.body.appendChild(badge);
                
                // Apply a stagger to multiple alerts
                const alerts = document.querySelectorAll('[id^="alert-badge-"]');
                const alertCount = alerts.length;
                badge.style.top = `${(alertCount * 3) + 1}rem`;
                
                // Fade in
                setTimeout(() => {
                    badge.style.opacity = '1';
                }, 10);
            } else {
                badge.querySelector('.message').textContent = message;
            }
            
            // Update countdown
            startCountdown(type);
        }
        
        // Function to remove alert badge
        function removeAlertBadge(type) {
            const badge = document.getElementById(`alert-badge-${type}`);
            if (badge) {
                badge.style.opacity = '0';
                setTimeout(() => {
                    badge.remove();
                    // Reposition remaining badges
                    const alerts = document.querySelectorAll('[id^="alert-badge-"]');
                    alerts.forEach((alert, index) => {
                        alert.style.top = `${(index * 3) + 1}rem`;
                    });
                }, 500);
            }
        }
        
        // Function to start countdown on alert badge
        function startCountdown(type) {
            const badge = document.getElementById(`alert-badge-${type}`);
            if (!badge) return;
            
            const countdownEl = badge.querySelector('.countdown');
            if (!countdownEl) return;
            
            // Clear any existing intervals
            if (badge.countdownInterval) {
                clearInterval(badge.countdownInterval);
            }
            
            // Update countdown every second
            badge.countdownInterval = setInterval(() => {
                const timeLeft = Math.ceil((alertStates[type].until - Date.now()) / 1000);
                
                if (timeLeft <= 0) {
                    clearInterval(badge.countdownInterval);
                    return;
                }
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                countdownEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        // Function to update header alert status
        function updateHeaderAlertStatus() {
            const hasActiveAlert = Object.values(alertStates).some(state => state.active);
            const headerElement = document.querySelector('header');
            
            if (hasActiveAlert && headerElement) {
                if (!headerElement.classList.contains('alert-mode')) {
                    headerElement.classList.add('alert-mode');
                    
                    // Create alert banner if it doesn't exist
                    if (!document.getElementById('alert-banner')) {
                        const banner = document.createElement('div');
                        banner.id = 'alert-banner';
                        banner.className = 'bg-red-900 text-white py-2 px-4 rounded-lg mt-2 flex items-center justify-between animate-pulse';
                        banner.innerHTML = `
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                <span>ALERT MODE: Vehicle in danger! Some alerts may have been resolved but system remains in alert state.</span>
                            </div>
                            <div id="alert-time-remaining" class="text-xs bg-red-700 px-2 py-1 rounded"></div>
                        `;
                        headerElement.appendChild(banner);
                    }
                    
                    // Update alert time remaining
                    updateAlertTimeRemaining();
                }
            } else if (headerElement && headerElement.classList.contains('alert-mode')) {
                headerElement.classList.remove('alert-mode');
                const banner = document.getElementById('alert-banner');
                if (banner) {
                    banner.remove();
                }
            }
        }
        
        // Function to update alert time remaining
        function updateAlertTimeRemaining() {
            const timeEl = document.getElementById('alert-time-remaining');
            if (!timeEl) return;
            
            // Find the latest alert end time
            const latestEndTime = Math.max(
                ...Object.values(alertStates)
                    .filter(state => state.active)
                    .map(state => state.until)
            );
            
            // Update the time remaining
            const updateTime = () => {
                const timeLeft = Math.ceil((latestEndTime - Date.now()) / 1000);
                
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    return;
                }
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timeEl.textContent = `Alert mode ends in: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            };
            
            updateTime();
            const interval = setInterval(updateTime, 1000);
        }

        // Function to fetch data from NodeMCU
        async function fetchData() {
    // const token = "eS5DxAjsnwDMyzoPqB96P0m3FOkpk8pR";
    // const baseUrl = `https://blynk.cloud/external/api/get?token=${token}`;

    try {
        // const [battery, temperature, gas, fire, lat, lon] = await Promise.all([
        //     fetch(`${baseUrl}&pin=V0`).then(res => res.text()),
        //     fetch(`${baseUrl}&pin=V1`).then(res => res.text()),
        //     fetch(`${baseUrl}&pin=V2`).then(res => res.text()),
        //     fetch(`${baseUrl}&pin=V3`).then(res => res.text()),
        //     fetch(`${baseUrl}&pin=V4`).then(res => res.text()),
        //     fetch(`${baseUrl}&pin=V5`).then(res => res.text())
        // ]);

        const data = {
            battery: 70,
            temperature: 27,
            gasDetected: true,
            fireDetected: false,
            latitude: 30.5,
            longitude: 76.6
        };

        updateUI(data);

        // Check for alert conditions and send email notification if needed
        checkAlertConditions(data);

        // Reset offline status
        document.querySelectorAll('.offline-indicator').forEach(el => {
            if (el) el.style.display = 'none';
        });

        const bodyElement = document.body;
        if (bodyElement) bodyElement.classList.remove('offline-mode');

    } catch (error) {
        console.error('Error fetching data:', error);

        const connectionStatus = document.getElementById('connection-status');
        if (connectionStatus) {
            connectionStatus.className = 'connection-status bg-red-900 text-red-300';
            connectionStatus.innerHTML = '<span class="connection-dot bg-red-300"></span>Connection Error';
        }

        showOfflineStatus();
    }
}

        // Function to check alert conditions and send email if needed
        let lastAlertTime = 0;
        const ALERT_COOLDOWN = 300000; // 5 minutes cooldown between alerts
        
        function checkAlertConditions(data) {
            const now = Date.now();
            
            // Check if any alert condition is met
            const highTemp = data.temperature > 50;
            const alertConditionMet = highTemp || data.gasDetected || data.fireDetected;
            
            // If alert condition is met and cooldown period has passed
            if (alertConditionMet && (now - lastAlertTime > ALERT_COOLDOWN)) {
                lastAlertTime = now;
                
                // Prepare alert data
                const alertData = {
                    email: "nitishmehan0608@gmail.com",
                    battery: data.battery,
                    temperature: data.temperature,
                    gasDetected: data.gasDetected,
                    fireDetected: data.fireDetected,
                    latitude: data.latitude,
                    longitude: data.longitude
                };
                
                // Send alert notification
                sendAlertNotification(alertData);
            }
        }
        
        // Function to send alert notification via POST request
        async function sendAlertNotification(data) {
            console.log("Send Notifications ");
            
            // The URL to your alert notification service
            const alertUrl = "https://send-chitkara.vercel.app/api/evCar";
            
            try {
                const response = await fetch(alertUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    console.log("Alert notification sent successfully");
                    showAlertSentNotification();
                } else {
                    console.error("Failed to send alert notification:", await response.text());
                }
            } catch (error) {
                console.error("Error sending alert notification:", error);
            }
        }
        
        // Function to show a notification that alert was sent
        function showAlertSentNotification() {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-red-900 text-white p-4 rounded-lg shadow-lg z-50 animate-pulse';
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-bell mr-2"></i>
                    <span>Alert notification sent</span>
                </div>
            `;
            
            // Add to document
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-500');
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }

        // Function to show offline status with null checks
        function showOfflineStatus() {
            // Update last updated time to show it's offline
            const now = new Date();
            const lastUpdatedElement = document.getElementById('last-updated');
            if (lastUpdatedElement) {
                lastUpdatedElement.textContent = `${now.toLocaleString()} (Car Offline)`;
            }
            
            // Update all sensors to show offline
            updateSensorStatus('battery-sensor-status', 'Offline', 'text-red-500');
            updateSensorStatus('temp-sensor-status', 'Offline', 'text-red-500');
            updateSensorStatus('gas-sensor-status', 'Offline', 'text-red-500');
            updateSensorStatus('fire-sensor-status', 'Offline', 'text-red-500');
            updateSensorStatus('gps-sensor-status', 'Offline', 'text-red-500');

            // Add offline class to body for potential global styling
            const bodyElement = document.body;
            if (bodyElement) {
                bodyElement.classList.add('offline-mode');
            }
            
            // Add offline indicators if they don't exist yet
            if (!document.querySelector('.offline-indicator')) {
                const cards = document.querySelectorAll('.neon-border');
                cards.forEach(card => {
                    if (card) {
                        const indicator = document.createElement('div');
                        indicator.className = 'offline-indicator absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-70 z-10 rounded-lg';
                        indicator.innerHTML = '<div class="text-red-500 text-xl font-bold orbitron animate-pulse">CAR OFFLINE</div>';
                        card.style.position = 'relative';
                        card.appendChild(indicator);
                    }
                });
                
                // Show dashes instead of values
                updateElementText('battery-percentage', '--');
                updateElementText('battery-percentage-small', '--');
                updateElementText('temperature', '--');
                updateElementText('temperature-small', '--');
                updateElementText('latitude', '--');
                updateElementText('longitude', '--');
                updateElementText('battery-last-reading', '--');
                updateElementText('temp-last-reading', '--');
                updateElementText('gas-last-reading', '--');
                updateElementText('fire-last-reading', '--');
                updateElementText('gps-last-reading', '--');
                
                // Set battery bar to 0
                const batteryBar = document.getElementById('battery-bar');
                if (batteryBar) {
                    batteryBar.style.width = '0%';
                }
                
                // Reset battery needle
                const batteryNeedle = document.getElementById('battery-needle');
                if (batteryNeedle) {
                    batteryNeedle.style.transform = 'translateX(-50%) rotate(-90deg)';
                }
            }
        }
        
        // Helper function to update element text with null check
        function updateElementText(id, text) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = text;
            }
        }

        // Helper function to update sensor status
        function updateSensorStatus(id, text, className) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = text;
                element.className = className;
            }
        }
        
        // Helper function to update sensor values
        function updateSensorValue(id, text) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = text;
            }
        }

        // Initialize particles and speedometer ticks
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            createSpeedometerTicks();
            
            // Try to fetch data on load
            fetchData();
        });

        // Periodically try to fetch data
        setInterval(fetchData, 5000); // Try to fetch data every 5 seconds
        
        // Add glowing effect to sensor dots
        setInterval(() => {
            document.querySelectorAll('.sensor-dot').forEach(dot => {
                if (!dot.classList.contains('active')) {
                    dot.style.opacity = (Math.sin(Date.now() / 500) + 1) / 2 * 0.7 + 0.3;
                }
            });
        }, 50);
    </script>
</body>
</html>